# OptDisPro

This repository contains the code implementation for the paper **"OptDisPro: LLM-based Multi-agent Framework for Flexibly Adapting Heuristic Optimal DisFlow"**.

## Overview

This project aims to achieve automatic generation, solution, and execution of optimal power flow code for distribution networks through large language model (LLM) based multi-agent systems. The framework leverages multiple intelligent agents to collaboratively handle the complex task of power flow optimization in distribution systems.

## Current Status

**Note**: This paper has been accepted for publication in IEEE Transactions on Smart Grid. The complete codebase is now available, including:

- Agent prompt templates (available in both Chinese and English versions)
- Complete multi-agent system implementation
- Network foundation code (Network_code.py)
- Core workflow testing code (test_core_workflow.py)
- Generated code samples for different optimization objectives
- Test datasets

## Agent Prompts

The agent prompts are provided in two versions:
- **Chinese version**: Original prompts written in Chinese
- **English version**: Translated prompts in English

The original prompts were developed in Chinese and then translated to English for broader accessibility.

## Code Generation Examples

Below are three example objective functions generated by the framework for different optimization goals:

### 1. Maximize PV Generation
**optimization_example_pv.py**  
This objective function aims to maximize the total power output from all PV systems in the network.
```python
def targetfunction(self):
    """
    Objective: Maximize total PV generation.
    """
    self.pv_generation = {}
    for i, name in enumerate(self.pvsystem_names):
        DSSText.command = f'New Monitor.pvmonitor{i} element=PVSystem.{name} terminal=1 mode=1'
    self.solve('Daily', 50, '[10, 0.4]', self.T_daily)
    for i, name in enumerate(self.pvsystem_names):
        DSSMonitors.Name = f'pvmonitor{i}'
        pv_power = np.array(DSSMonitors.Channel(1))
        self.pv_generation[name] = np.sum(pv_power)
    self.total_pv_generation = sum(self.pv_generation.values())
    print('Total PV generation:', self.total_pv_generation)
```

### 2. Minimize Transformer Overload Rate
**optimization_example_trans.py**  
This objective function calculates and minimizes the overload rate of all transformers in the network.
```python
def targetfunction(self):
    """
    Objective: Minimize transformer overload rate.
    """
    self.transformer_overload = {}
    for i, name in enumerate(self.transformer_names):
        DSSText.command = f'New Monitor.transmonitor{i} element=Transformer.{name} terminal=1 mode=1'
    self.solve('Daily', 50, '[10, 0.4]', self.T_daily)
    for i, name in enumerate(self.transformer_names):
        DSSMonitors.Name = f'transmonitor{i}'
        transformer_power = np.array(DSSMonitors.Channel(1))
        DSSTransformers.Name = name
        rated_power = DSSTransformers.kva
        overload_rate = np.max(transformer_power) / rated_power
        self.transformer_overload[name] = overload_rate
    self.max_overload_rate = max(self.transformer_overload.values())
    print('Max transformer overload rate:', self.max_overload_rate)
```

### 3. Minimize the Node Voltage Deviation (V)
**optimization_example_volt.py**  
This objective function calculates and minimizes the voltage deviation at all nodes in the network.
```python
def targetfunction(self):
    """
    Objective: Minimize node voltage deviation.
    """
    self.voltage_deviation = {}
    for i, name in enumerate(self.line_names):
        DSSText.command = f'New Monitor.linemonitor{i} element=line.{name} 1 mode=0'
    self.solve('Daily', 50, '[10, 0.4]', self.T_daily)
    for i, name in enumerate(self.line_names):
        DSSCircuit.lines.name = name
        line_bus2 = DSSCircuit.lines.bus2
        DSSCircuit.SetActiveBus(line_bus2)
        kVBase = DSSCircuit.ActiveBus.kVBase
        DSSMonitors.Name = f'linemonitor{i}'
        for j in range(1, self.line_phases[i]+1):
            voltage_pu = np.array(DSSMonitors.Channel(j*2-1)) / (1000 * kVBase)
            voltage_deviation = np.sum(abs(voltage_pu - 1)) / voltage_pu.shape[0]
            self.voltage_deviation[f'Node{line_bus2}Phase{j}'] = voltage_deviation
    self.max_voltage_deviation = max(self.voltage_deviation.values())
    print('Max node voltage deviation:', self.max_voltage_deviation)
```

## Paper Abstract

OptDisPro proposes a novel multi-agent framework that utilizes large language models to flexibly adapt and generate heuristic optimal distribution flow solutions. The system employs multiple specialized agents working in coordination to automate the traditionally manual process of power flow optimization code development and execution.

## Repository Structure

The repository contains:
- `agent/` - Agent implementation and prompt templates
  - `prompt/` - Agent prompts (Chinese and English versions)
  - `multi_agent_system.py` - Complete multi-agent system implementation
- `Network_code.py` - Network foundation code for DSS integration
- `test_core_workflow.py` - Core workflow testing and validation
- `optimization_example_*.py` - Code generation examples for different objectives
- `dssdata/` - Test datasets and network data
- Documentation (README.md)

## Citation

If you use this work in your research, please cite our paper:

```bibtex
@ARTICLE{11201936,
  author={Li, Zhengbo and Yang, Haolan and Liu, Youbo and Xiang, Yue and Gao, Hongjun and Liu, Jingyao and Liu, Junyong},
  journal={IEEE Transactions on Smart Grid},
  title={OptDisPro: LLM-based Multi-agent Framework for Flexibly Adapting Heuristic Optimal DisFlow},
  year={2025},
  volume={},
  number={},
  pages={1-1},
  keywords={Optimization;Codes;Encoding;Distribution networks;Heuristic algorithms;Adaptation models;Power system stability;Load flow;Complexity theory;Power system reliability;Artificial Intelligence;Large Language Models;Multi-agent Framework;Optimal Power Flow},
  doi={10.1109/TSG.2025.3620496}
}
```

## Contact

For questions regarding this implementation, please refer to the paper authors or open an issue in this repository.
